# MCCE4 Documentation

## Mechanism

The documentation site will be hosted on github page https://gunnerlab.github.io/MCCE4/

The documentation site has a yaml file that controls what to be presented and how to be presentated. The actual content is either from md files or extracted from the in-code documentation.

Sphinx is used to generate documentation from the docstrings in code.

Google style docstring will be used.

Folder structure:
<pre>
MCCE4
├── MCCE_bin (programs)
│   └── mcce4 (modules)
│       └── mcce (internal modules)
└── docs (Sphinx documentation setup)
</pre>

## Site Structure
What is MCCE?

Quick Start
 * Install MCCE
 * Test run a small protein

Examples
 * A pKa calculation
 * A Em calculation

MCCE Core
 * Minimum requirement
 * 4-step dance
 * Interchange files between steps
 * Customize your own MCCE program

MCCE Tools

MCCE Parameters
 * MCCE run instruction file run.prm.default
 * MCCE molecule topology files
   * File format
   * Make a ftpl file for new cofactor 

Develop with MCCE


## Setting Up Site Management Environment
Some tools and software are required to generate the documentation site.

### Installation of essential tools
Create a closed environment:
<pre>
conda create -n sphinx
conda activate sphinx
conda install pip
pip install sphinx
pip install sphinx-rtd-theme
</pre>

### Initialize the project

#### Run sphinx-quickstart
Go to docs folder, run `sphinx-quickstart`

<pre>
(sphinx) jmao@Junjun-Laptop:~/projects/MCCE4/docs$ sphinx-quickstart
Welcome to the Sphinx 7.4.7 quickstart utility.

Please enter values for the following settings (just press Enter to
accept a default value, if one is given in brackets).

Selected root path: .

You have two options for placing the build directory for Sphinx output.
Either, you use a directory "_build" within the root path, or you separate
"source" and "build" directories within the root path.
> Separate source and build directories (y/n) [n]: y

The project name will occur in several places in the built documentation.
> Project name: MCCE4 Documentation
> Author name(s): Junjun Mao
> Project release []: 0.0.1

If the documents are to be written in a language other than English,
you can select a language here by its language code. Sphinx will then
translate text that it generates into that language.

For a list of supported codes, see
https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-language.
> Project language [en]:

Creating file /home/jmao/projects/MCCE4/docs/source/conf.py.
Creating file /home/jmao/projects/MCCE4/docs/source/index.rst.
Creating file /home/jmao/projects/MCCE4/docs/Makefile.
Creating file /home/jmao/projects/MCCE4/docs/make.bat.

Finished: An initial directory structure has been created.

You should now populate your master file /home/jmao/projects/MCCE4/docs/source/index.rst and create other documentation
source files. Use the Makefile to build the docs, like so:
   make builder
where "builder" is one of the supported builders, e.g. html, latex or linkcheck.

(sphinx) jmao@Junjun-Laptop:~/projects/MCCE4/docs$ ls
Makefile  README.md  build  make.bat  source
</pre>

#### Description of the folders from Sphinx:

* **source:** This is where all our .rst files will reside.
* **source/conf.py:** This is the file where all Sphinx configuration settings (including the settings we specified during the sphinx-quickstart setup) are specified. When any make <builder> or sphinx-build <builder> command is called, Sphinx runs this file to extract the desired configuration.
* **source/index.rst:** This is the file which tells Sphinx how to render our index.html page. In general, each source/\*.rst file is converted to a corresponding build/html/*.html page when make html is called.
* **build:** This is the directory where the output of any builder is stored when a make <builder> or sphinx-build <builder> command is called. For the purposes of this tutorial, we are particularly interested in building html documentation and thus our build outputs will be stored under build/html. Note that build/html does not exist just yet, but will be autogenerated when we call make html later.

#### COnfigure conf.py
Go to docs/source, edit conf.py:

`html_theme = 'sphinx_rtd_theme'`

Configure where Python programs need to be extracted by Sphinx. Add these lines to the the top of conf.py file.
<pre>
import os
import sys

sys.path.insert(0, os.path.abspath('../../MCCE_bin'))
</pre>

**It is important to note here that the absolute path must be specified in relation to where conf.py resides."

#### requirements.txt 
Under /MCCE4, create file requirements.txt. Put these lines in the file:
<pre>
# MCCE Core
numpy
scipy
</pre>

This file is needed by autodoc when generating documentation. Autodoc will install the required packages in a virtual environment.

#### Install `napoleon` extension to support google style docstrings: 

Ref: https://www.sphinx-doc.org/en/master/usage/extensions/napoleon.html

Add this to extension section of conf.py:
<pre>
# Add napoleon to the extensions list
extensions = ['sphinx.ext.napoleon']
</pre>

The documentation says to use this command to build documentation:
`sphinx-apidoc -f -o docs/source projectdir`


### VS Code configuration
Under Settings --> Extentions, search autoDocstring - Python Docstring Generator, Install

Once installed, an gear icon appears under autoDoctring plugin at the place of "Install" button. Click on this button to find Docstring style setting, then choose "Google"



## Update Site

### Write docstring for a module
<pre>
"""Example Google style docstrings.

This module demonstrates documentation as specified by the `Google Python
Style Guide`_. Docstrings may extend over multiple lines. Sections are created
with a section header and a colon followed by a block of indented text.

Example:
    Examples can be given using either the ``Example`` or ``Examples``
    sections. Sections support any reStructuredText formatting, including
    literal blocks::

        $ python example_google.py

Section breaks are created by resuming unindented text. Section breaks
are also implicitly created anytime a new section starts.

Attributes:
    module_level_variable1 (int): Module level variables may be documented in
        either the ``Attributes`` section of the module docstring, or in an
        inline docstring immediately following the variable.

        Either form is acceptable, but the two should not be mixed. Choose
        one convention to document module level variables and be consistent
        with it.
</pre>

### Write docstring for a class
<pre>
class ExampleClass(object):
    """The summary line for a class docstring should fit on one line.

    If the class has public attributes, they may be documented here
    in an ``Attributes`` section and follow the same formatting as a
    function's ``Args`` section. Alternatively, attributes may be documented
    inline with the attribute's declaration (see __init__ method below).

    Properties created with the ``@property`` decorator should be documented
    in the property's getter method.

    Attributes:
        attr1 (str): Description of `attr1`.
        attr2 (:obj:`int`, optional): Description of `attr2`.

    """
</pre>

### Write docstring for a function
Some examples of google format are

<pre>
def abc(a: int, c = [1,2]):
    """_summary_

    Args:
        a (int): _description_
        c (list, optional): _description_. Defaults to [1,2].

    Raises:
        AssertionError: _description_

    Returns:
        _type_: _description_
    """
    if a > 10:
        raise AssertionError("a is more than 10")

    return c
</pre>


### Populate the documentation
The content layout control is in file docs/source.index.rst

The sphinx guide for Restructured Text is here https://thomas-cokelaer.info/tutorials/sphinx/rest_syntax.html

A minimum index.rst can look like this:
<pre>
.. MCCE4 Documentation documentation master file, created by
   sphinx-quickstart on Wed Jul 24 07:52:04 2024.
   You can adapt this file completely to your liking, but it should at least
   contain the root `toctree` directive.

MCCE4 Documentation documentation
=================================

Add your content using ``reStructuredText`` syntax. See the
`reStructuredText <https://www.sphinx-doc.org/en/master/usage/restructuredtext/index.html>`_
documentation for details.


.. toctree::
   :maxdepth: 2
   :caption: Contents:

Indices and tables
==================

* :ref:`genindex`
* :ref:`modindex`
* :ref:`search`
</pre>

Go to docs/ and make sure sphinx environment is activated. Run:

`make clean`

`make html`

A folder that contains html pages will be created under docs/build.

To generate documentation from docstrings with sphinx:

`sphinx-apidoc -o ./source ../MCCE_bin`

rst files will be generated under source/

Now we need to put these files in index.rst

<pre>
.. MCCE4 Documentation documentation master file, customized by Junjun Mao

MCCE4 Documentation documentation
=================================

.. toctree::
   :maxdepth: 2
   :caption: Contents:

mcce4

Indices and tables
==================

* :ref:`genindex`
* :ref:`modindex`
* :ref:`search`
</pre>

`make html` will create a set of new html pages.

### Publish to github page




